<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>A specialty farmer. Program execution. Playbook. - Preview</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="error-handler.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Georgia", "Times New Roman", serif;
        background: #e8e8e8;
        padding: 20px;
        line-height: 1.7;
        color: #333;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      @page {
        size: letter;
        margin: 0.5in;
      }

      .pdf-export-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 2000;
        width: 44px;
        height: 44px;
        background: #f4f6f8;
        color: #34495e;
        border: none;
        padding: 0;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.12);
        transition: background 0.2s ease, transform 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .pdf-export-btn:hover {
        background: #e7ebf0;
        transform: translateY(-1px);
      }

      .pdf-export-btn:active {
        transform: scale(0.96);
      }

      .pdf-export-btn.exporting {
        background: #dfe3e7;
        cursor: wait;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: transparent;
        box-shadow: none;
      }

      .page {
        width: 8.5in;
        min-height: 11in;
        max-height: 11in;
        padding: 1in;
        margin: 0 auto 20px;
        background: white;
        position: relative;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        page-break-inside: auto;
        break-inside: auto;
        page-break-after: always;
        break-after: page;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
      }
      
      /* Page content wrapper that flows to next page when full */
      .page-content {
        flex: 1;
        overflow: visible;
      }

      /* Cover page - exactly letter size */
      .page#cover {
        height: 11in;
        min-height: 11in;
        max-height: 11in;
        overflow: hidden;
        page-break-after: always;
        break-after: page;
      }

      /* TOC page - exactly letter size, allow scrolling if content exceeds */
      .page#toc {
        height: 11in;
        min-height: 11in;
        max-height: 11in;
        overflow-y: auto;
        overflow-x: hidden;
        page-break-after: always;
        break-after: page;
      }

      /* Content pages - exactly letter size (11in height) */
      .page:not(#cover):not(#toc) {
        width: 8.5in;
        height: 11in;
        min-height: 11in;
        max-height: 11in;
        padding: 1in;
        margin: 0 auto 20px;
        background: white;
        position: relative;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        page-break-after: always;
        break-after: page;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
      }
      
      /* Ensure page content respects page boundaries */
      .page:not(#cover):not(#toc) .page-content {
        max-height: 9in; /* 11in page - 1in top padding - 0.75in bottom space - 0.25in buffer = ~9in */
        overflow: hidden;
      }
      
      /* Page content wrapper - content area fits within page */
      .page-content {
        flex: 1;
        min-height: 0;
        overflow: hidden;
        padding-bottom: 0.75in; /* Space for page number at bottom */
      }

      /* Last page - can be shorter if content doesn't fill it */
      .page:last-of-type {
        min-height: auto;
        height: auto;
        max-height: 11in;
        overflow: visible;
      }
      
      .page:last-of-type .page-content {
        max-height: none;
        overflow: visible;
      }
      
      /* Sections (h2) always start on a new page */
      .page:not(#cover):not(#toc) > .page-content > h2:first-child {
        page-break-before: always;
        break-before: page;
        margin-top: 0;
      }

      @media print {
        body {
          background: white;
          padding: 0;
        }
        .page {
          margin: 0;
          box-shadow: none;
          width: 8.5in;
          min-height: 11in;
          height: auto;
          max-height: none;
          overflow: visible;
          page-break-after: always;
          break-after: page;
        }
        .page#cover {
          page-break-after: always;
          break-after: page;
          height: 11in;
        }
        .page#toc {
          page-break-after: always;
          break-after: page;
          height: auto;
          min-height: 11in;
        }
        .page:not(#cover):not(#toc) {
          page-break-after: auto;
          break-after: auto;
          height: auto;
          min-height: 11in;
          max-height: none;
        }
        .page:last-of-type {
          page-break-after: auto;
          break-after: auto;
          min-height: auto;
        }
        h2 {
          page-break-before: always;
          break-before: page;
          page-break-after: avoid;
          break-after: avoid;
        }
        .page > h2:first-child {
          page-break-before: auto;
          break-before: auto;
        }
        .toc-item {
          page-break-inside: avoid;
          break-inside: avoid;
        }
        .pdf-export-btn,
        .floating-toc,
        .search-toolbar,
        .search-shell,
        .search-toggle {
          display: none;
        }
      }

      .page-number {
        position: absolute;
        bottom: 0.75in;
        right: 1in;
        font-size: 10pt;
        color: #666;
      }

      h1 {
        font-size: 24pt;
        text-align: center;
        margin-bottom: 10pt;
        color: #2c3e50;
        page-break-after: avoid;
      }

      h2 {
        font-size: 18pt;
        margin-top: 0;
        margin-bottom: 12pt;
        padding-top: 20pt;
        color: #34495e;
        border-bottom: 2px solid #3498db;
        padding-bottom: 5pt;
        page-break-before: always;
        page-break-after: avoid;
        break-before: page;
        break-after: avoid;
        orphans: 3;
        widows: 3;
      }

      /* First h2 in a page doesn't need page break */
      .page > h2:first-child {
        page-break-before: auto;
        break-before: auto;
        padding-top: 0;
      }

      h3 {
        font-size: 14pt;
        margin-top: 15pt;
        margin-bottom: 8pt;
        color: #2c3e50;
        page-break-before: avoid;
        page-break-after: avoid;
        break-before: avoid;
        break-after: avoid;
        orphans: 3;
        widows: 3;
      }

      h4 {
        font-size: 12pt;
        margin-top: 12pt;
        margin-bottom: 6pt;
        color: #34495e;
        page-break-before: avoid;
        page-break-after: avoid;
        break-before: avoid;
        break-after: avoid;
        orphans: 3;
        widows: 3;
      }

      .cover-page {
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: 9in;
      }

      .logo-container {
        margin-bottom: 30pt;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .logo {
        max-width: 200px;
        max-height: 200px;
        width: auto;
        height: auto;
      }

      .cover-title {
        font-size: 34pt;
        font-weight: 700;
        margin-bottom: 25pt;
        color: #1a252f;
        letter-spacing: 1pt;
        line-height: 1.5;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        font-style: normal;
        text-transform: none;
      }
      
      .cover-title br {
        display: block;
        margin: 10pt 0;
        content: "";
      }
      
      .cover-title br:first-child {
        margin-top: 0;
      }
      
      .cover-title br:last-child {
        margin-bottom: 0;
      }

      .cover-subtitle {
        font-size: 18pt;
        margin-bottom: 30pt;
        color: #7f8c8d;
      }

      .cover-info {
        font-size: 12pt;
        margin-top: 40pt;
        color: #7f8c8d;
      }

      .toc {
        margin-top: 15pt;
        font-size: 10pt;
        page-break-inside: auto;
      }

      .toc-item {
        margin: 5pt 0;
        font-size: 10pt;
        line-height: 1.4;
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .toc-item a {
        color: #3498db;
        text-decoration: none;
        display: flex;
        justify-content: space-between;
      }

      .toc-item a:hover {
        text-decoration: underline;
      }

      .toc-item a span {
        color: #7f8c8d;
        font-weight: normal;
      }

      .toc-subitem {
        margin-left: 15pt;
        margin-top: 2pt;
        font-size: 9pt;
        line-height: 1.3;
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .toc-subitem a {
        color: #7f8c8d;
      }

      p {
        margin: 10pt 0;
        text-align: justify;
        font-size: 11pt;
        orphans: 3;
        widows: 3;
      }

      ul {
        margin: 10pt 0;
        margin-left: 30pt;
        orphans: 2;
        widows: 2;
      }

      li {
        margin: 5pt 0;
        font-size: 11pt;
      }

      .section-divider {
        border-top: 1px solid #ecf0f1;
        margin: 20pt 0;
      }

      .key-points {
        background: #f8f9fa;
        padding: 15pt;
        margin: 15pt 0;
        border-left: 4px solid #3498db;
      }

      .key-points h4 {
        margin-top: 0;
      }

      code {
        background: #f4f4f4;
        padding: 2pt 6pt;
        border-radius: 3pt;
        font-family: "Courier New", monospace;
        font-size: 10pt;
      }

      /* Image support */
      img {
        max-width: 100%;
        height: auto;
        page-break-inside: avoid;
        margin: 10pt 0;
      }

      .image-container {
        text-align: center;
        margin: 15pt 0;
        page-break-inside: avoid;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        background: #f7f9fc;
        border: 1px solid #e1e8f2;
        border-radius: 12px;
        padding: 3pt;
      }

      .image-caption {
        font-size: 9pt;
        color: #7f8c8d;
        margin-top: 5pt;
        font-style: italic;
      }

      .pipeline-diagram {
        width: 100%;
        max-width: 100%;
        max-height: 6.25in;
        height: auto;
        margin: 14pt 0 6pt;
        page-break-inside: avoid;
        break-inside: avoid;
        display: block;
        background: linear-gradient(135deg, #fdfefe, #f2f6fb);
        padding: 12pt;
        border-radius: 14px;
        border: 1px solid #dbe5f3;
        box-sizing: border-box;
        box-shadow: 0 10px 30px rgba(36, 64, 97, 0.12);
      }

      .pipeline-bg {
        fill: white;
        stroke: #dbe7f3;
        stroke-width: 2;
      }
      
      .pipeline-band {
        fill: rgba(52, 152, 219, 0.08);
        stroke: #e2ebf6;
        stroke-width: 2;
      }

      .pipeline-track {
        stroke: #c7d7e6;
        stroke-width: 10;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .pipeline-track-highlight {
        stroke: url(#pipelineGradient);
        stroke-width: 16;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .pipeline-arrowhead {
        fill: #617389;
        opacity: 0.75;
      }

      .pipeline-connector {
        stroke: #c2d4e8;
        stroke-width: 4;
      }

      .pipeline-card {
        fill: white;
        stroke: #d0deef;
        stroke-width: 2;
        filter: drop-shadow(0 6px 14px rgba(36, 64, 97, 0.18));
      }

      .pipeline-card-title {
        font-family: "Georgia", "Times New Roman", serif;
        font-size: 24px;
        font-weight: 700;
        letter-spacing: 0.2px;
        fill: #1f2d3d;
        text-anchor: middle;
      }

      .pipeline-card-subtitle {
        font-family: "Georgia", "Times New Roman", serif;
        font-size: 16px;
        fill: #3b708d;
        letter-spacing: 0.1px;
        text-anchor: middle;
      }

      .pipeline-node {
        stroke: #ffffff;
        stroke-width: 5;
        filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.16));
      }

      .pipeline-number {
        font-family: "Georgia", "Times New Roman", serif;
        font-size: 22px;
        font-weight: bold;
        fill: white;
        text-anchor: middle;
        dominant-baseline: middle;
      }

      .pipeline-note {
        font-family: "Georgia", "Times New Roman", serif;
        font-size: 13px;
        fill: #526981;
        font-weight: 600;
        letter-spacing: 0.2px;
      }

      .stage-1 {
        fill: #2e86de;
      }

      .stage-1-card {
        fill: #eaf3ff;
        stroke: #b9d4f5;
      }

      .stage-2 {
        fill: #17a589;
      }

      .stage-2-card {
        fill: #e8fbf4;
        stroke: #b9ead8;
      }

      .stage-3 {
        fill: #f39c12;
      }

      .stage-3-card {
        fill: #fff5e6;
        stroke: #f2cf9b;
      }

      .stage-4 {
        fill: #5c6bc0;
      }

      .stage-4-card {
        fill: #eef1ff;
        stroke: #c3cbe9;
      }

      .stage-5 {
        fill: #27ae60;
      }

      .stage-5-card {
        fill: #e9f6ec;
        stroke: #b7e3c5;
      }

      .stage-6 {
        fill: #d35400;
      }

      .stage-6-card {
        fill: #fff0e6;
        stroke: #f5c7a8;
      }

      .stage-7 {
        fill: #34495e;
      }

      .stage-7-card {
        fill: #eef1f5;
        stroke: #c7d0dc;
      }

      .search-shell {
        position: fixed;
        top: 20px;
        right: 20px;
        max-width: 520px;
        width: min(520px, calc(100vw - 140px));
        z-index: 1300;
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: flex-end;
      }

      .search-toggle {
        border: 1px solid #dce6f2;
        background: #ffffff;
        color: #1f2d3d;
        border-radius: 999px;
        padding: 10px 14px;
        font-size: 11pt;
        font-weight: 700;
        letter-spacing: 0.2px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 10px 22px rgba(0, 0, 0, 0.12);
        transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, border 0.2s ease;
        pointer-events: auto;
      }

      .search-toggle:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 28px rgba(0, 0, 0, 0.14);
        background: #f7faff;
        border-color: #c5d7f2;
      }

      .search-shell:not(.collapsed) .search-toggle {
        background: #eaf1ff;
        border-color: #c8d8f5;
        box-shadow: 0 12px 26px rgba(0, 0, 0, 0.14);
      }

      .search-toolbar {
        width: 100%;
        background: white;
        padding: 12px 14px;
        border: 1px solid #dce6f2;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.14);
        display: grid;
        gap: 8px;
        align-items: center;
      }

      .search-toolbar label {
        font-size: 10pt;
        color: #526981;
        font-weight: 600;
        letter-spacing: 0.3px;
      }

      .search-input-row {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 8px;
        align-items: center;
      }

      .search-field {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #d6deea;
        border-radius: 10px;
        font-size: 12pt;
        font-family: inherit;
        background: #f9fbff;
        transition: all 0.2s ease;
      }

      .search-field:focus {
        outline: none;
        border-color: #3498db;
        background: #ffffff;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.15);
      }

      .search-clear {
        padding: 10px 12px;
        border: 1px solid #d6deea;
        background: #f5f7fb;
        color: #526981;
        border-radius: 10px;
        cursor: pointer;
        font-size: 11pt;
        transition: background 0.2s ease, color 0.2s ease, transform 0.1s ease;
      }

      .search-clear:hover {
        background: #eaf1fb;
        color: #34495e;
      }

      .search-clear:active {
        transform: translateY(1px);
      }

      .search-status {
        font-size: 9.5pt;
        color: #7f8c8d;
      }

      .search-results {
        max-height: 260px;
        overflow-y: auto;
        border-top: 1px solid #edf2f7;
        padding-top: 6px;
        display: none;
      }

      .search-results.active {
        display: block;
      }

      .search-result {
        width: 100%;
        text-align: left;
        background: #f9fbff;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        padding: 8px 10px;
        margin-bottom: 6px;
        cursor: pointer;
        transition: border 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
      }

      .search-result:hover {
        border-color: #bcd4f5;
        box-shadow: 0 6px 18px rgba(52, 152, 219, 0.14);
        transform: translateY(-1px);
      }

      .search-result-title {
        font-size: 11pt;
        color: #2c3e50;
        font-weight: 700;
        margin-bottom: 4px;
      }

      .search-preview {
        font-size: 10pt;
        color: #526981;
        line-height: 1.45;
      }

      .search-result mark {
        background: #fff4c2;
        color: #2c3e50;
        padding: 0 2px;
        border-radius: 3px;
      }

      .search-hit-highlight {
        background: #fff8d6;
        transition: background 0.6s ease;
      }

      .search-shell.collapsed .search-toolbar {
        display: none;
      }

      .floating-toc {
        position: fixed;
        right: 22px;
        bottom: 28px;
        width: 320px;
        max-width: 85vw;
        z-index: 1200;
        font-size: 11pt;
        color: #1f2d3d;
      }

      .toc-toggle {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 48px;
        height: 48px;
        border-radius: 24px;
        border: none;
        background: #ffffff;
        color: #2c3e50;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.18);
        cursor: pointer;
        display: grid;
        place-items: center;
        transition: transform 0.2s ease, box-shadow 0.25s ease, background 0.2s ease;
      }

      .toc-toggle:hover {
        transform: translateY(-2px);
        box-shadow: 0 14px 36px rgba(0, 0, 0, 0.2);
        background: #f8fafc;
      }

      .toc-panel {
        pointer-events: none;
        opacity: 0;
        transform: translateY(12px);
        transition: opacity 0.25s ease, transform 0.25s ease;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(5px);
        box-shadow: 0 20px 45px rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        padding: 14px;
        margin-bottom: 10px;
        max-height: min(70vh, 520px);
        overflow: hidden;
      }

      .floating-toc.open .toc-panel {
        pointer-events: auto;
        opacity: 1;
        transform: translateY(0);
      }

      .floating-toc.open .toc-toggle {
        transform: rotate(45deg);
        background: #eaf1ff;
      }

      .toc-panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding-bottom: 8px;
        border-bottom: 1px solid #ecf0f1;
      }

      .toc-kicker {
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-size: 9pt;
        color: #7f8c8d;
      }

      .toc-title {
        font-weight: 600;
        color: #1a252f;
        font-size: 12pt;
      }

      .toc-close {
        border: none;
        background: #f4f6f8;
        color: #34495e;
        width: 30px;
        height: 30px;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s ease, transform 0.2s ease;
      }

      .toc-close:hover {
        background: #e7ebf0;
        transform: translateY(-1px);
      }

      .toc-body {
        margin-top: 8px;
        max-height: calc(min(70vh, 520px) - 56px);
        overflow-y: auto;
        padding-right: 4px;
      }

      .toc-section {
        margin-bottom: 6px;
        border-radius: 8px;
        transition: background 0.2s ease;
      }

      .toc-section:hover {
        background: #f8fafc;
      }

      .toc-section-header {
        width: 100%;
        border: none;
        background: transparent;
        color: #1f2d3d;
        font-weight: 600;
        font-size: 11pt;
        text-align: left;
        padding: 8px 6px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        gap: 8px;
      }

      .toc-section-header .chevron {
        transition: transform 0.2s ease;
        font-size: 10pt;
        color: #7f8c8d;
      }

      .toc-section.open .chevron {
        transform: rotate(90deg);
      }

      .toc-section:hover .chevron {
        color: #3498db;
      }

      .toc-link {
        color: inherit;
        text-decoration: none;
        display: block;
        width: 100%;
      }

      .toc-sublist {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.25s ease;
        padding-left: 10px;
      }

      .toc-section.open .toc-sublist {
        max-height: 500px;
      }

      .toc-sub-link {
        display: block;
        color: #4a6075;
        text-decoration: none;
        font-size: 10pt;
        padding: 6px 8px;
        border-radius: 6px;
        transition: background 0.15s ease, color 0.15s ease;
      }

      .toc-sub-link:hover {
        background: #eaf1ff;
        color: #1f2d3d;
      }

      .toc-item-active > .toc-section-header,
      .toc-sub-link.active {
        background: #eaf1ff;
        color: #1a252f;
      }

      .toc-pill {
        position: absolute;
        top: -12px;
        right: 54px;
        padding: 6px 10px;
        background: #1f2d3d;
        color: white;
        border-radius: 999px;
        font-size: 9pt;
        letter-spacing: 0.04em;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        transform: translateY(6px);
        opacity: 0;
        transition: opacity 0.25s ease, transform 0.25s ease;
        pointer-events: none;
      }

      .floating-toc.open .toc-pill {
        opacity: 1;
        transform: translateY(0);
      }

      @media (max-width: 1024px) {
        .floating-toc {
          right: 12px;
          bottom: 18px;
        }

        .toc-panel {
          width: calc(100vw - 32px);
        }
      }

      @media (max-width: 720px) {
        .floating-toc {
          left: 50%;
          transform: translateX(-50%);
          width: calc(100vw - 30px);
        }

        .floating-toc.open .toc-panel {
          box-shadow: 0 16px 36px rgba(0, 0, 0, 0.15);
        }

        .toc-toggle {
          right: calc(50% - 24px);
        }
      }

      @media (prefers-reduced-motion: reduce) {
        .floating-toc *,
        .floating-toc {
          transition: none !important;
        }
      }

      @media (max-width: 1400px) {
        .search-shell {
          right: 16px;
          width: calc(100vw - 60px);
        }
        .search-toolbar {
          box-shadow: 0 10px 24px rgba(0, 0, 0, 0.12);
        }
      }

      @media (max-width: 720px) {
        .search-shell {
          top: 16px;
          width: calc(100vw - 32px);
        }
        .search-toggle {
          width: 100%;
          justify-content: center;
        }
        .search-input-row {
          grid-template-columns: 1fr;
        }
        .search-clear {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <button
      class="pdf-export-btn"
      onclick="enhancedPDFExport()"
      aria-label="Download PDF"
      title="Download PDF"
      style="display: none;"
    >
      ‚¨áÔ∏é
    </button>

    <div class="search-shell collapsed" aria-label="Playbook search">
      <button type="button" class="search-toggle" id="search-toggle" aria-expanded="false" aria-controls="search-panel">
        üîç Search playbook
      </button>
      <div class="search-toolbar" id="search-panel" role="search" aria-label="Search the playbook">
        <label for="playbook-search">Search the playbook</label>
        <div class="search-input-row">
          <input
            type="search"
            id="playbook-search"
            class="search-field"
            placeholder="Search sections, tactics, or keywords"
            aria-label="Search the playbook"
          />
          <button type="button" id="clear-search" class="search-clear" aria-label="Clear search">Clear</button>
        </div>
        <div class="search-status" id="search-status">Search sections, tactics, or keywords.</div>
        <div class="search-results" id="search-results" role="listbox" aria-label="Search results"></div>
      </div>
    </div>

    <div class="floating-toc" aria-label="Table of contents">
      <div class="toc-pill">Navigate</div>
      <button class="toc-toggle" aria-expanded="false" aria-controls="toc-panel" title="Open table of contents">‚â°</button>
      <div class="toc-panel" id="toc-panel" role="navigation" aria-label="Table of contents">
        <div class="toc-panel-header">
          <div>
            <div class="toc-kicker">On this playbook</div>
            <div class="toc-title">Quick jump</div>
          </div>
          <button class="toc-close" aria-label="Close navigation">√ó</button>
        </div>
        <div class="toc-body">
          <div class="toc-list"></div>
        </div>
      </div>
    </div>

    <div class="container" id="document-content">
      <!-- DYNAMIC_CONTENT -->

    <script>
            A specialty farmer.<br />
            Program execution.<br />
            Playbook.
          </div>
          <div class="cover-subtitle">Business-to-Business Market Segment</div>
          <div style="font-size: 12pt; margin-top: 30pt; color: #7f8c8d">
            Complete Guide for Targeting, Engaging, Selling,<br />
            Implementing, and Supporting Specialty Orchard, Vineyard, and Avocado Clients
          </div>
          <div class="cover-info">
            <br /><br />
            Version 2.0<br />
            Updated: November 2024
          </div>
          <div style="margin-top: 60pt; font-size: 10pt; color: #95a5a6; max-width: 6in; margin-left: auto; margin-right: auto">
            This document provides Soil Seed & Water representatives with a clear, standardized roadmap for delivering regenerative programs for orchards, vineyards, and avocados
            using Pomona and SSW protocols.<br /><br />
            All proprietary information contained herein is confidential and intended solely for internal use by Soil Seed & Water representatives.
          </div>
        </div>
        <div class="page-number">1</div>
      </div>

      <!-- Table of Contents - Dynamically flows across multiple pages if content is too long -->
      <div class="page" id="toc">
        <h1>TABLE OF CONTENTS</h1>
        <div class="toc">
          <div class="toc-item">
            <a href="#section1">1. PURPOSE OF THE DOCUMENT <span>Page 3</span></a>
          </div>
          <div class="toc-item">
            <a href="#section2">2. RESEARCH & ELIGIBILITY <span>Page 4</span></a>
            <div class="toc-subitem"><a href="#section2">2.1 Crop Focus (Expanded)</a></div>
            <div class="toc-subitem"><a href="#section2">2.2 Geographic Scope</a></div>
            <div class="toc-subitem"><a href="#section2">2.3 Common Crop Challenges</a></div>
            <div class="toc-subitem"><a href="#section2">2.4 Common Farmer Challenges</a></div>
            <div class="toc-subitem"><a href="#section2">2.5 Suitability Criteria</a></div>
          </div>
          <div class="toc-item">
            <a href="#section3">4. VALUE PROPOSITION <span>Page 5</span></a>
            <div class="toc-subitem"><a href="#section3">4.1 What We Offer</a></div>
            <div class="toc-subitem"><a href="#section3">4.2 Why It Matters</a></div>
            <div class="toc-subitem"><a href="#section3">4.3 How We Deliver</a></div>
            <div class="toc-subitem"><a href="#section3">4.4 Why SSW Is Different</a></div>
            <div class="toc-subitem"><a href="#section3">4.5 Economic Value Drivers</a></div>
          </div>
          <div class="toc-item">
            <a href="#section4">5. CRM INTEGRATION - COMPLETE WORKFLOW <span>Page 6</span></a>
            <div class="toc-subitem"><a href="#section4">5.1 Lead Capture</a></div>
            <div class="toc-subitem"><a href="#section4">5.2 Segmentation</a></div>
            <div class="toc-subitem"><a href="#section4">5.3 Automations</a></div>
            <div class="toc-subitem"><a href="#section4">5.4 Tracking & Analytics</a></div>
            <div class="toc-subitem"><a href="#section4">5.5 Smart Calling Workflow</a></div>
            <div class="toc-subitem"><a href="#section4">5.6 Farm Visits</a></div>
            <div class="toc-subitem"><a href="#section4">5.7 Deals & Conversions</a></div>
            <div class="toc-subitem"><a href="#section4">5.8 Reporting</a></div>
          </div>
          <div class="toc-item">
            <a href="#section5">6. OUTREACH STRATEGY & TACTICS <span>Page 7</span></a>
            <div class="toc-subitem"><a href="#section5">6.1 Prospect Identification</a></div>
            <div class="toc-subitem"><a href="#section5">6.2 Initial Outreach - Hook Point</a></div>
            <div class="toc-subitem"><a href="#section5">6.3 Discovery Questions</a></div>
            <div class="toc-subitem"><a href="#section5">6.4 Smart Calling Framework</a></div>
            <div class="toc-subitem"><a href="#section5">6.5 Communication Template - Sean Example</a></div>
          </div>
          <div class="toc-item">
            <a href="#section6">7. LEAD NURTURING STRATEGY <span>Page 8</span></a>
            <div class="toc-subitem"><a href="#section6">7.1 5-Email Nurture Series</a></div>
            <div class="toc-subitem"><a href="#section6">7.2 Follow-Up Cadence</a></div>
            <div class="toc-subitem"><a href="#section6">7.3 Newsletters</a></div>
            <div class="toc-subitem"><a href="#section6">7.4 Samples and Gifts</a></div>
            <div class="toc-subitem"><a href="#section6">7.5 Education ‚Üí Credibility ‚Üí Proposal Flow</a></div>
          </div>
          <div class="toc-item">
            <a href="#section7">8. SALES PROCESS <span>Page 9</span></a>
            <div class="toc-subitem"><a href="#section7">8.1 Qualification Steps</a></div>
            <div class="toc-subitem"><a href="#section7">8.2 Site Visit Scheduling</a></div>
            <div class="toc-subitem"><a href="#section7">8.3 Proposal Structure</a></div>
            <div class="toc-subitem"><a href="#section7">8.4 Pricing Logic</a></div>
            <div class="toc-subitem"><a href="#section7">8.5 Closing Steps</a></div>
          </div>
          <div class="toc-item">
            <a href="#section8">9. IMPLEMENTATION <span>Page 10</span></a>
            <div class="toc-subitem"><a href="#section8">9.1 Soil Test & Protocol Setup</a></div>
            <div class="toc-subitem"><a href="#section8">9.2 Order Fulfillment & Delivery</a></div>
            <div class="toc-subitem"><a href="#section8">9.3 Monitoring & Follow-Up</a></div>
          </div>
          <div class="toc-item">
            <a href="#section9">10. TIMELINE & KPIs <span>Page 11</span></a>
            <div class="toc-subitem"><a href="#section9">10.1 Annual Calendar (Q1-Q4)</a></div>
            <div class="toc-subitem"><a href="#section9">10.2 Key Performance Targets</a></div>
          </div>
          <div class="toc-item">
            <a href="#section10">11. TOOLS & PLATFORMS <span>Page 12</span></a>
            <div class="toc-subitem"><a href="#section10">11.1 CRM</a></div>
            <div class="toc-subitem"><a href="#section10">11.2 Route Planner</a></div>
            <div class="toc-subitem"><a href="#section10">11.3 AI Advisors</a></div>
          </div>
          <div class="toc-item">
            <a href="#section11">12. APPENDIX <span>Page 13</span></a>
            <div class="toc-subitem"><a href="#section11">12.1 Pomona Blend Spec Sheet</a></div>
            <div class="toc-subitem"><a href="#section11">12.2 Seriokai's Secret Blend Spec Sheet</a></div>
            <div class="toc-subitem"><a href="#section11">12.3 Bucchas Blend Spec Sheet (Vines)</a></div>
            <div class="toc-subitem"><a href="#section11">12.4 Orchard Protocol</a></div>
            <div class="toc-subitem"><a href="#section11">12.5 Smart Calling Script</a></div>
            <div class="toc-subitem"><a href="#section11">12.6 Email Templates</a></div>
            <div class="toc-subitem"><a href="#section11">12.7 Sample Proposals</a></div>
            <div class="toc-subitem"><a href="#section11">12.8 Maps of Target Orchards</a></div>
            <div class="toc-subitem"><a href="#section11">12.9 CRM Screenshots/Mock-ups</a></div>
            <div class="toc-subitem"><a href="#section11">12.10 Tradeshow Protocols</a></div>
            <div class="toc-subitem"><a href="#section11">12.11 Regional Crop Research</a></div>
          </div>
        </div>
        <div class="page-number">2</div>
      </div>

      <!-- Section 1: Purpose of the Document -->
      <div class="page" id="section1">
        <h2>1. PURPOSE OF THE DOCUMENT</h2>

        <p>
          This document provides Soil Seed & Water representatives with a clear, standardized roadmap for targeting, engaging, selling, implementing,
          and supporting specialty orchard, vineyard, and avocado clients in the Business-to-Business Market Segment.
        </p>

        <p>
          This playbook establishes the complete outreach-to-fulfillment system, simplifies field execution, and aligns all teams on how to deliver
          regenerative programs for orchards, vineyards, and avocados using Pomona and SSW protocols.
        </p>

        <div class="key-points">
          <h4>KEY OBJECTIVES:</h4>
          <ul>
            <li>Standardize the sales approach across all representatives</li>
            <li>Provide clear, actionable steps from lead generation to customer success</li>
            <li>Integrate CRM workflows at every stage of the sales process</li>
            <li>Establish measurable KPIs and timelines for program execution</li>
            <li>Create a repeatable system for scaling orchard, vineyard, and avocado client acquisition</li>
          </ul>
        </div>

        <h3>WHO THIS DOCUMENT IS FOR:</h3>
        <ul>
          <li>Sales representatives targeting specialty farmers</li>
          <li>Field representatives conducting site visits</li>
          <li>Marketing team developing campaigns and content</li>
          <li>Management tracking performance and pipeline metrics</li>
          <li>Operations team coordinating fulfillment and delivery</li>
        </ul>

        <h3>HOW TO USE THIS PLAYBOOK:</h3>
        <p>
          This document is designed as a step-by-step execution guide. Each section builds upon the previous one, creating a complete sales and
          implementation system. Use the table of contents to navigate directly to specific sections as needed, but we recommend reviewing the entire
          document to understand the full process flow.
        </p>

        <div class="page-number">3</div>
      </div>

      <div class="page" id="section2">
        <h2>2. RESEARCH & ELIGIBILITY</h2>

        <p>
          Thorough research ensures we focus on the orchards most likely to benefit from Pomona and SSW protocols. Use these criteria to build a
          targeted list, qualify quickly, and assign priority before outreach begins.
        </p>

        <h3>2.1 Crop Focus (Expanded)</h3>
        <ul>
          <li><strong>Pistachios:</strong> High-value nut crop with strong ROI on soil health and water-efficiency gains.</li>
          <li><strong>Pome fruits (apples, pears):</strong> Focus on fruit quality, storability, and soil structure improvements.</li>
          <li><strong>Stone fruits (peach, plum, cherry, apricot, nectarine):</strong> Emphasize fruit set, color, and consistency.</li>
          <li>
            <strong>Vineyards (wine/table/raisin grapes):</strong> Quality and yield stability through improved nutrient uptake and soil biology.
          </li>
          <li><strong>Avocados:</strong> Water efficiency, salinity management, and root health are primary levers.</li>
          <li><strong>Citrus (orange, lemon, lime, grapefruit):</strong> Peel quality, brix, and stress mitigation in heat/drought.</li>
          <li><strong>Other regional high-value orchards:</strong> Add local specialty crops as mapping reveals clusters.</li>
        </ul>

        <h3>2.2 Geographic Scope</h3>
        <ul>
          <li>300-mile target radius from SSW operations, segmented by priority zones.</li>
          <li>Map by crop density and market value; create heatmaps of top counties/regions.</li>
          <li>Flag irrigation water source (district, well, surface) and any water restrictions.</li>
          <li>Note access/logistics: truck suitability, road conditions, and preferred delivery points.</li>
        </ul>

        <h3>2.3 Common Crop Challenges</h3>
        <ul>
          <li>Low organic matter and weak soil structure</li>
          <li>Compaction and limited infiltration</li>
          <li>Water inefficiency and uneven distribution</li>
          <li>Micronutrient deficiencies and poor nutrient uptake</li>
          <li>Low water-holding capacity</li>
          <li>Weed pressure and low microbial activity</li>
        </ul>

        <h3>2.4 Common Farmer Challenges</h3>
        <ul>
          <li>Limited equipment access or downtime for applications</li>
          <li>Soil biology and nutrient management knowledge gaps</li>
          <li>Logistics constraints (labor, timing, trucking)</li>
          <li>Cost management pressures and aversion to input risk</li>
        </ul>

        <h3>2.5 Suitability Criteria</h3>
        <ul>
          <li>Crop compatibility with Pomona + supporting amendments</li>
          <li>Economic viability (acreage, revenue potential, input cost baseline)</li>
          <li>Access and logistics feasibility (equipment fit, delivery access)</li>
          <li>Decision-maker identified and reachable (owner, farm manager, PCA/consultant)</li>
          <li>Clear agronomic pain points we can solve (water, nutrition, soil structure)</li>
        </ul>

        <div class="key-points">
          <h4>DATA TO CAPTURE IN CRM</h4>
          <ul>
            <li>Crop type, acreage, orchard age, and block layout</li>
            <li>Water source and irrigation method (drip, micro-sprinkler, flood)</li>
            <li>Current fertilizer/soil program and spend (if known)</li>
            <li>Primary pain points and recent yield/quality trends</li>
            <li>Equipment available for application and delivery constraints</li>
            <li>Contact roles (owner, manager, PCA/CCAs) with phone/email preferences</li>
          </ul>
        </div>

        <div class="page-number">4</div>
      </div>

      <div class="page" id="section3">
        <h2>4. VALUE PROPOSITION</h2>
        <p>
          The value proposition is the foundation of every conversation with specialty orchard, vineyard, and avocado growers. This section provides the core messaging
          that differentiates SSW from commodity suppliers and positions us as regenerative agriculture partners.
        </p>

        <h3>4.1 What We Offer</h3>
        <p>
          We deliver long-term orchard, vineyard, and avocado health and regeneration through our specialized crop blends and supporting SSW protocols. This is not a single-product sale‚Äîit's a comprehensive
          regenerative soil health program designed to transform degraded soils into productive, resilient ecosystems.
        </p>

        <h4>CORE OFFERING:</h4>
        <ul>
          <li>Regenerative soil health programs tailored to specialty orchards, vineyards, and avocados</li>
          <li>Crop-specific blends: Pomona (orchards), Seriokai's Secret (avocados/citrus), and Bucchas (vineyards)</li>
          <li>Supporting protocols: Compost blends, compost tea extracts (drench), clean wood fiber, and mycorrhizal treatments</li>
          <li>Customized application schedules aligned with crop phenology and seasonal needs</li>
          <li>Ongoing field support, soil testing, and protocol adjustments</li>
          <li>Complete logistics coordination: delivery, equipment support, and application guidance</li>
        </ul>

        <h4>SPECIALTY CROP BLENDS:</h4>

        <p><strong>1. POMONA BLEND - For Orchards (Stone Fruits, Pome Fruits, Pistachios)</strong></p>
        
        <p><strong>DESCRIPTION:</strong></p>
        <p>Pomona Blend is a granular, OMRI-listed plant food blend specifically formulated for pome and stone fruit trees. This blend provides targeted micronutrient support during critical growth phases to promote vigorous growth, abundant yields, and optimal fruit quality.</p>
        
        <p><strong>KEY CHARACTERISTICS:</strong></p>
        <ul>
          <li>Granular formulation</li>
          <li>OMRI Listed for organic use</li>
          <li>Made in USA</li>
          <li>Best for: Pome and Stone Fruit Trees</li>
        </ul>

        <p><strong>INGREDIENTS & PURPOSE:</strong></p>
        <ul>
          <li><strong>WORM CASTINGS:</strong> Enhance soil structure, water retention, and aeration; provide slow-release nutrients (NPK); introduce beneficial microorganisms for improved soil health and disease suppression.</li>
          <li><strong>MAGNESIUM SULFATE:</strong> Supplies essential magnesium and sulfur for chlorophyll production, photosynthesis, and protein synthesis, supporting vigorous plant growth.</li>
          <li><strong>ZINC SULFATE:</strong> Provides zinc to promote enzyme activation, protein synthesis, robust root and shoot development, and increased flowering and fruiting.</li>
          <li><strong>ORGANIC DAIRY COMPOST:</strong> Improves soil structure, enriches with nutrients, boosts microbial activity, and enhances water retention for sustainable, healthy plant growth.</li>
        </ul>

        <p><strong>APPLICATION:</strong></p>
        <p><strong>FOR NEW PLANTINGS:</strong></p>
        <ul>
          <li>Mix 1 part Pomona Blend with 4 parts existing soil</li>
        </ul>
        <p><strong>FOR ESTABLISHED TREES:</strong></p>
        <ul>
          <li>Top-dress with a 1/2" layer and gently work into the soil surface</li>
          <li>Water thoroughly after application</li>
          <li>Timing: Post leaf-out (typically April‚ÄìMay)</li>
          <li>Applied within tree drip lines for maximum root zone efficiency</li>
        </ul>

        <p><strong>KEY BENEFITS:</strong></p>
        <ul>
          <li>Specially formulated for pome and stone fruit trees to promote vigorous growth and abundant yields</li>
          <li>Enriches soil with essential nutrients and beneficial microbes for healthier roots and disease resistance</li>
          <li>Improves soil structure, aeration, and water retention for optimal fruit tree development</li>
          <li>Supports robust photosynthesis and nutrient uptake with magnesium and zinc for stronger, more productive trees</li>
        </ul>

        <p><strong>PACKAGING SIZES:</strong></p>
        <ul>
          <li>9 LB bags</li>
          <li>1 CF (Cubic Foot) bags</li>
          <li>2.2 CY TOTE (Cubic Yard Tote)</li>
          <li>BULK (TONS/CY)</li>
          <li>TRUCKLOAD BULK (22-24 TONS)</li>
        </ul>

        <p><strong>TARGET CROPS:</strong></p>
        <ul>
          <li>Pistachios</li>
          <li>Stone fruits (peach, plum, cherry, apricot, nectarine)</li>
          <li>Pome fruits (apple, pear)</li>
          <li>Other high-value orchard crops</li>
        </ul>

        <p><strong>2. SERIKAI'S SECRET BLEND - For Avocados and Citrus Trees</strong></p>
        
        <p><strong>DESCRIPTION:</strong></p>
        <p>Seriokai's Secret Blend is a granular, OMRI-listed plant food blend specially formulated for avocado and citrus trees. This blend combines premium organic ingredients to boost root strength, fruit yield, and disease resistance while improving soil structure and water retention.</p>
        
        <p><strong>KEY CHARACTERISTICS:</strong></p>
        <ul>
          <li>Granular formulation</li>
          <li>OMRI Listed for organic use</li>
          <li>Made in USA</li>
          <li>Best for: Avocado and Citrus Trees</li>
        </ul>

        <p><strong>INGREDIENTS & PURPOSE:</strong></p>
        <ul>
          <li><strong>WORM CASTINGS:</strong> Enhance soil structure, aeration, and water retention; provide balanced, slow-release nutrients (N, P, K); introduce beneficial microorganisms for improved soil health and disease suppression.</li>
          <li><strong>ZINC SULFATE:</strong> Supplies essential zinc to correct deficiencies, supporting enzyme activation, protein synthesis, and robust root development.</li>
          <li><strong>POTASSIUM SULFATE:</strong> Delivers potassium and sulfur to boost water retention, photosynthesis, protein synthesis, and plant resilience.</li>
          <li><strong>ORGANIC DAIRY COMPOST:</strong> Improves soil structure, nutrient content, and microbial activity for better water retention and sustainable plant growth.</li>
        </ul>

        <p><strong>APPLICATION:</strong></p>
        <p><strong>FOR NEW PLANTINGS:</strong></p>
        <ul>
          <li>Mix 1 part Blend with 4 parts existing soil</li>
        </ul>
        <p><strong>FOR ESTABLISHED TREES:</strong></p>
        <ul>
          <li>Top-dress with a 1/2" layer and gently work into the soil surface</li>
          <li>Water thoroughly after application</li>
          <li>Apply within drip line for maximum effectiveness</li>
        </ul>

        <p><strong>KEY BENEFITS:</strong></p>
        <ul>
          <li>Specially formulated for avocado and citrus trees to boost root strength, fruit yield, and disease resistance</li>
          <li>Enriches soil with essential nutrients and beneficial microbes for sustained, balanced growth</li>
          <li>Improves soil structure, water retention, and aeration for healthier, more resilient trees</li>
          <li>Supports organic gardening with premium, natural ingredients for long-term soil vitality</li>
        </ul>

        <p><strong>PACKAGING SIZES:</strong></p>
        <ul>
          <li>9 LB bags</li>
          <li>1 CF (Cubic Foot) bags</li>
          <li>2.2 CY TOTE (Cubic Yard Tote)</li>
          <li>BULK (TONS/CY)</li>
          <li>TRUCKLOAD BULK (22-24 TONS)</li>
        </ul>

        <p><strong>TARGET CROPS:</strong></p>
        <ul>
          <li>Avocados</li>
          <li>Citrus (oranges, lemons, limes, grapefruit)</li>
          <li>Other subtropical tree crops</li>
        </ul>

        <p><strong>3. BUCCHAS BLEND (VINES) - For Vineyards</strong></p>
        
        <p><strong>DESCRIPTION:</strong></p>
        <p>Bucchas Blend is specifically formulated for vineyard applications, designed to support grape vine health, fruit quality, and yield stability through improved nutrient uptake and soil biology. This blend addresses the unique needs of grape production systems.</p>
        
        <p><strong>KEY CHARACTERISTICS:</strong></p>
        <ul>
          <li>Formulated for vine crops</li>
          <li>Optimized for grape production systems</li>
          <li>Supports quality and yield stability</li>
        </ul>

        <p><strong>APPLICATION:</strong></p>
        <ul>
          <li>Timing: Based on vine phenology and seasonal growth patterns</li>
          <li>Method: Applied within vine rows or under vine canopies</li>
          <li>Purpose: Supports nutrient uptake and soil biology for grape production</li>
        </ul>

        <p><strong>TARGET CROPS:</strong></p>
        <ul>
          <li>Wine grapes</li>
          <li>Table grapes</li>
          <li>Raisin grapes</li>
          <li>Other vine crops</li>
        </ul>

        <p><strong>WHY BUCCHAS FOR VINEYARDS:</strong></p>
        <p>Vineyards have distinct nutritional and soil health requirements compared to tree crops. Grape vines benefit from specific nutrient profiles and soil conditions that support quality fruit development, sugar accumulation (brix), and overall vine health. Bucchas Blend is formulated to address these vineyard-specific needs.</p>
        
        <p><strong>NOTE:</strong> Complete spec sheet information for Bucchas Blend will be added when available.</p>

        <h4>SUPPORTING PROTOCOL COMPONENTS:</h4>

        <p><strong>4. Orchard/Vineyard Compost Blend</strong></p>
        <ul>
          <li>High-quality dairy compost applied under tree canopies</li>
          <li>Builds organic matter, improves structure, creates microbial habitat</li>
          <li>Year 1: 10 tons/canopy acre; maintenance: 5 tons/canopy acre annually</li>
        </ul>

        <p><strong>5. Compost Tea Extract (Drench)</strong></p>
        <ul>
          <li>Living microbial inoculant applied via water wagon or sprayer</li>
          <li>Pre-bud break application (February‚ÄìMarch) activates soil biology</li>
          <li>Second application before nut set (June‚ÄìJuly) supports nutrient cycling</li>
          <li>Super cost-effective biological activation</li>
        </ul>

        <p><strong>6. Clean Wood Fiber</strong></p>
        <ul>
          <li>Mulch application between orchard rows</li>
          <li>Erosion control, moisture retention, temperature regulation, weed suppression</li>
          <li>Improves water infiltration by 50% and prevents topsoil loss</li>
        </ul>

        <p><strong>7. Mycorrhizal Backfill Mix</strong></p>
        <ul>
          <li>Specialized fungal blend for new plantings and tree replacement</li>
          <li>One-time application establishes drought-tolerant root networks</li>
          <li>10x more cost-effective than treating mature trees</li>
        </ul>

        <h3>4.2 Why It Matters</h3>
        <p>
          Specialty orchard farmers face mounting pressure: declining soil health, water scarcity, rising input costs, and the need to maintain or increase yields. Our
          program addresses these challenges systematically, delivering measurable results that compound over time.
        </p>

        <h4>EXTENDED ORCHARD LIFESPAN:</h4>
        <ul>
          <li>Healthy soils support productive trees for 25‚Äì75+ years (vs. 15‚Äì20 years with degraded soils)</li>
          <li>Reduced tree mortality through improved root health and stress tolerance</li>
          <li>Legacy value: orchards become generational assets, not short-term investments</li>
        </ul>

        <h4>IMPROVED SOIL HEALTH:</h4>
        <ul>
          <li>Increased organic matter builds water-holding capacity and nutrient retention</li>
          <li>Enhanced microbial activity improves nutrient cycling and reduces fertilizer dependency</li>
          <li>Better soil structure prevents compaction and improves infiltration</li>
          <li>Biological diversity creates resilient ecosystems that adapt to stress</li>
        </ul>

        <h4>ECONOMIC GAINS:</h4>
        <ul>
          <li>Yield lift: Improved nutrient availability and water efficiency directly increase production</li>
          <li>Fertilizer reduction: Biological nutrient cycling reduces synthetic fertilizer needs by 20‚Äì40% over time</li>
          <li>Cost savings: Reduced water usage (up to 40% in some cases) and lower input costs improve margins</li>
          <li>Quality improvements: Better fruit/nut quality commands premium pricing</li>
        </ul>

        <h4>REDUCED INPUT COSTS OVER TIME:</h4>
        <ul>
          <li>Year 1: Foundation building (higher initial investment)</li>
          <li>Years 2‚Äì3: Maintenance applications (reduced tonnage, lower costs)</li>
          <li>Years 4+: Self-sustaining soil biology reduces dependency on external inputs</li>
          <li>Long-term ROI improves each year as soil health compounds</li>
        </ul>

        <h4>ENHANCED WATER EFFICIENCY:</h4>
        <ul>
          <li>Improved infiltration reduces runoff and increases retention</li>
          <li>Better root development accesses deeper water reserves</li>
          <li>Reduced irrigation needs lower operational costs and improve drought resilience</li>
          <li>Critical advantage in water-restricted regions</li>
        </ul>

        <h3>4.3 How We Deliver</h3>
        <p>
          SSW doesn't just sell products‚Äîwe deliver complete regenerative programs with hands-on support at every stage. Our delivery model ensures proper
          implementation, optimal timing, and continuous improvement.
        </p>

        <h4>ORCHARD-SPECIFIC TREATMENT PROTOCOLS:</h4>
        <ul>
          <li>Initial soil test and analysis to establish baseline and identify specific needs</li>
          <li>Customized protocol development based on crop type, soil conditions, and farmer goals</li>
          <li>Crop-specific timing: pistachio nut-set differs from citrus bloom, and protocols reflect this</li>
          <li>Block-by-block adjustments for soil variations within the same orchard</li>
        </ul>

        <h4>CUSTOMIZED SUPPLEMENT BLENDS:</h4>
        <ul>
          <li>Pomona ratios determined by crop needs and soil test results</li>
          <li>Supporting amendments selected based on deficiencies and goals</li>
          <li>Blend adjustments over time as soil health improves and needs change</li>
          <li>Volume pricing and multi-year commitment incentives</li>
        </ul>

        <h4>SEASONAL APPLICATION SCHEDULES:</h4>
        <ul>
          <li>Winter (Phase 1): Compost and wood fiber application for foundation building</li>
          <li>Pre-bud break (Phase 2): First drench application to activate soil biology</li>
          <li>Post leaf-out (Phase 3): Pomona blend application for nutrient support</li>
          <li>Pre nut-set/fruit-set: Second drench application for peak demand support</li>
          <li>Post-harvest: Maintenance applications and soil health monitoring</li>
        </ul>

        <h4>ONGOING FIELD SUPPORT AND CONSULTING:</h4>
        <ul>
          <li>Site visits: Monthly field visit weeks with on-site assessments</li>
          <li>Soil monitoring: Regular testing to track improvements and adjust protocols</li>
          <li>Photo documentation: Visual progress tracking in CRM</li>
          <li>Problem-solving: Rapid response to issues with protocol adjustments</li>
          <li>Education: Farmer training on regenerative principles and application methods</li>
        </ul>

        <h4>LOGISTICS AND EQUIPMENT SUPPORT:</h4>
        <ul>
          <li>Delivery coordination: Route planning and scheduling for efficient delivery</li>
          <li>Equipment support: Guidance on application equipment and methods</li>
          <li>Trucking coordination: Direct delivery or coordination with local trucking</li>
          <li>On-farm placement: Instructions for storage, handling, and application timing</li>
        </ul>

        <h3>4.4 Why SSW Is Different</h3>
        <p>
          Most suppliers sell products. SSW delivers partnerships. This fundamental difference creates long-term value that commodity suppliers cannot match.
        </p>

        <h4>TRUE PARTNERSHIP APPROACH (NOT JUST PRODUCT SALES):</h4>
        <ul>
          <li>We invest in your success: Our revenue depends on your results, not just product volume</li>
          <li>Long-term commitment: Multi-year programs with ongoing support, not transactional sales</li>
          <li>Shared risk: Trial programs and performance-based pricing align our interests</li>
          <li>Relationship focus: We know your operation, your challenges, and your goals</li>
        </ul>

        <h4>DEEP EXPERTISE IN REGENERATIVE AGRICULTURE:</h4>
        <ul>
          <li>Specialized knowledge: Years of experience with tree crops and regenerative protocols</li>
          <li>Proven results: Case studies and field data from successful implementations</li>
          <li>Continuous learning: We stay current with latest research and adapt protocols</li>
          <li>Problem-solving capability: We diagnose issues and adjust, not just sell more product</li>
        </ul>

        <h4>PRODUCTION CAPACITY AND CONSISTENCY:</h4>
        <ul>
          <li>Own production facilities: Dairy compost, worm castings, and Pomona blend manufactured in-house</li>
          <li>Quality control: Consistent product quality you can depend on season after season</li>
          <li>Scalability: Capacity to support large operations without supply constraints</li>
          <li>Reliability: You won't face product shortages or quality variations</li>
        </ul>

        <h4>COMPREHENSIVE FIELD SUPPORT:</h4>
        <ul>
          <li>Field representatives: Experienced agronomists who understand your operation</li>
          <li>Site visits: Regular on-farm assessments, not just phone calls</li>
          <li>Documentation: Photos, soil notes, and recommendations logged in CRM</li>
          <li>Responsive service: Quick answers and rapid problem-solving when issues arise</li>
        </ul>

        <h4>CONSULTING AND ADVISORY SERVICES:</h4>
        <ul>
          <li>Soil health consulting: Beyond product recommendations to system-level thinking</li>
          <li>Protocol development: Customized programs, not one-size-fits-all solutions</li>
          <li>Education and training: Help you understand the "why" behind the "what"</li>
          <li>Strategic planning: Multi-year roadmaps for soil regeneration and yield improvement</li>
        </ul>

        <h4>TRUCKING AND LOGISTICS SUPPORT:</h4>
        <ul>
          <li>Delivery coordination: We handle the logistics, you focus on farming</li>
          <li>Route optimization: Efficient delivery reduces your time and costs</li>
          <li>Flexible scheduling: Work around your harvest and application windows</li>
          <li>On-farm placement: Direct delivery to where you need it, when you need it</li>
        </ul>

        <h4>EQUIPMENT SUPPORT AND COORDINATION:</h4>
        <ul>
          <li>Application guidance: Recommendations on equipment and methods</li>
          <li>Equipment coordination: Help connect you with applicators if needed</li>
          <li>Method optimization: Ensure you're applying products correctly for maximum effectiveness</li>
          <li>Cost-effective solutions: Find the most efficient application methods for your operation</li>
        </ul>

        <h3>4.5 Economic Value Drivers</h3>
        <p>
          The economic case for SSW programs is built on multiple value drivers that compound over time. Understanding these drivers helps you communicate ROI and
          justify investment to cost-conscious farmers.
        </p>

        <h4>YIELD STRENGTH AND CONSISTENCY:</h4>
        <ul>
          <li>Increased production: 10‚Äì30% yield improvements are common as soil health improves</li>
          <li>Consistency: Reduced year-to-year variability creates predictable revenue</li>
          <li>Quality improvements: Better fruit/nut quality commands premium pricing</li>
          <li>Risk reduction: Healthy soils buffer against weather stress and disease</li>
        </ul>

        <h4>SOIL HEALTH IMPROVEMENTS:</h4>
        <ul>
          <li>Organic matter increase: Each 1% increase in OM holds 20,000+ gallons of water per acre</li>
          <li>Water infiltration: 50%+ improvement reduces runoff and increases retention</li>
          <li>Nutrient retention: Healthy soils hold nutrients, reducing leaching and waste</li>
          <li>Biological activity: Active soil biology cycles nutrients more efficiently</li>
        </ul>

        <h4>FERTILIZER REDUCTION (COST SAVINGS):</h4>
        <ul>
          <li>Year 1: Baseline fertilizer program continues while soil health builds</li>
          <li>Year 2‚Äì3: 20‚Äì30% reduction in synthetic fertilizer needs as biology takes over</li>
          <li>Year 4+: 30‚Äì40% reduction possible as soil becomes self-sustaining</li>
          <li>Cost savings: $50‚Äì$200+ per acre annually in reduced fertilizer costs</li>
        </ul>

        <h4>LONG-TERM ROI:</h4>
        <ul>
          <li>Year 1: Foundation investment (higher cost, building the system)</li>
          <li>Years 2‚Äì3: Maintenance phase (reduced costs, increasing benefits)</li>
          <li>Years 4+: Compound returns (lower costs, higher yields, better quality)</li>
          <li>5-year ROI: Typically 2‚Äì4x return on investment when all factors considered</li>
          <li>Extended lifespan: 25‚Äì75+ year productive lifespan vs. 15‚Äì20 years = generational value</li>
        </ul>

        <h4>RISK MITIGATION:</h4>
        <ul>
          <li>Drought resilience: Better water efficiency reduces irrigation dependency</li>
          <li>Disease resistance: Healthy soils and trees resist pathogens naturally</li>
          <li>Market volatility: Quality improvements provide pricing flexibility</li>
          <li>Regulatory compliance: Regenerative practices align with sustainability requirements</li>
          <li>Succession planning: Healthy orchards become valuable legacy assets</li>
        </ul>

        <div class="key-points">
          <h4>ECONOMIC CALCULATION FRAMEWORK:</h4>
          <p>When presenting economic value, use this framework:</p>
          <p><strong>1. Current State Baseline</strong></p>
          <ul>
            <li>Current yield (tons/acre or lbs/tree)</li>
            <li>Current fertilizer costs per acre</li>
            <li>Current water usage and costs</li>
            <li>Current quality metrics and pricing</li>
          </ul>
          <p><strong>2. Projected Improvements (Year 3‚Äì5)</strong></p>
          <ul>
            <li>Yield increase: 10‚Äì30% (conservative estimate)</li>
            <li>Fertilizer reduction: 20‚Äì40% (as biology takes over)</li>
            <li>Water efficiency: 20‚Äì40% reduction in irrigation needs</li>
            <li>Quality premium: 5‚Äì15% price improvement (if applicable)</li>
          </ul>
          <p><strong>3. Investment vs. Return</strong></p>
          <ul>
            <li>Program cost per acre (Year 1, Year 2‚Äì3, Year 4+)</li>
            <li>Cost savings: Fertilizer + water reduction</li>
            <li>Revenue increase: Yield lift √ó price</li>
            <li>Net improvement: Revenue increase + cost savings - program cost</li>
            <li>ROI timeline: When does cumulative benefit exceed cumulative cost?</li>
          </ul>
          <p><strong>4. Long-Term Value</strong></p>
          <ul>
            <li>Extended orchard lifespan: 10‚Äì50+ additional productive years</li>
            <li>Legacy value: Asset appreciation and generational transfer</li>
            <li>Risk reduction: Insurance value of resilient operation</li>
          </ul>
        </div>

        <div class="key-points">
          <h4>KEY MESSAGING POINTS:</h4>
          <ul>
            <li>"This is a capital investment in soil assets, not an expense"</li>
            <li>"Your orchard can thrive for 75+ years with proper soil health"</li>
            <li>"We're building a system that pays you back every year"</li>
            <li>"The longer you wait, the more expensive regeneration becomes"</li>
            <li>"Healthy soils are the foundation of profitable, sustainable farming"</li>
          </ul>
        </div>

        <div class="page-number">5</div>
      </div>

      <div class="page" id="section4">
        <h2>5. CRM INTEGRATION - COMPLETE WORKFLOW</h2>
        <p>
          Effective CRM integration is the backbone of successful orchard, vineyard, and avocado program execution. This section provides a complete workflow for capturing, managing, nurturing, and converting leads through every stage of the sales pipeline. All activities must be tracked in the CRM to ensure visibility, accountability, and data-driven decision-making.
        </p>
        <p><strong>CRM PLATFORM:</strong> [Which CRM platform is being used? (e.g., HubSpot, Salesforce, Pipedrive, Monday.com, custom solution)]</p>
        <h4>INTEGRATION REQUIREMENTS:</h4>
        <ul>
          <li>[What third-party integrations are needed? (e.g., email marketing platform, route planning software, calendar systems, payment processing)]</li>
          <li>[What API connections are required?]</li>
          <li>[What data synchronization needs exist?]</li>
        </ul>
        <div class="key-points">
          <h4>NOTE:</h4>
          <p>The complete CRM Integration section (5.1 through 5.8) with detailed workflows, field requirements, automation specifications, and reporting structures is available in the main playbook text file. This section includes:</p>
          <ul>
            <li>5.1 Lead Capture - Complete lead entry requirements and workflows</li>
            <li>5.2 Segmentation - Multi-dimensional segmentation strategies</li>
            <li>5.3 Automations - Email sequences, task automation, lead scoring</li>
            <li>5.4 Tracking & Analytics - Comprehensive metrics and reporting</li>
            <li>5.5 Smart Calling Workflow - Prioritized calling strategies</li>
            <li>5.6 Farm Visits - Visit scheduling and documentation</li>
            <li>5.7 Deals & Conversions - Deal management and pipeline tracking</li>
            <li>5.8 Reporting - Executive, team, and custom reporting</li>
          </ul>
          <p>All sections use square brackets [ ] to indicate questions about needed information that should be filled in based on your specific CRM setup.</p>
        </div>
        <div class="page-number">6</div>
      </div>

      <div class="page" id="section5">
        <h2>6. OUTREACH STRATEGY & TACTICS</h2>
        <p><em>Content to be added...</em></p>
        <div class="page-number">7</div>
      </div>

      <div class="page" id="section6">
        <h2>7. LEAD NURTURING STRATEGY</h2>
        <p><em>Content to be added...</em></p>
        <div class="page-number">8</div>
      </div>

      <div class="page" id="section7">
        <h2>8. SALES PROCESS</h2>
        <p><em>Content to be added...</em></p>
        <div class="page-number">9</div>
      </div>

      <div class="page" id="section8">
        <h2>9. IMPLEMENTATION</h2>
        <p><em>Content to be added...</em></p>
        <div class="page-number">10</div>
      </div>

      <div class="page" id="section9">
        <h2>10. TIMELINE & KPIs</h2>
        <p><em>Content to be added...</em></p>
        <div class="page-number">11</div>
      </div>

      <div class="page" id="section10">
        <h2>11. TOOLS & PLATFORMS</h2>
        <p><em>Content to be added...</em></p>
        <div class="page-number">12</div>
      </div>

    </div>

    <script>
      const tocState = {
        observer: null,
        mutationObserver: null,
        rebuildTimer: null,
      };

      const smoothScrollToId = (targetId) => {
        const target = document.getElementById(targetId);
        if (!target) return;
        target.scrollIntoView({ behavior: "smooth", block: "start" });
      };

      const setActiveTocItem = (activeId) => {
        document.querySelectorAll(".toc-sub-link.active, .toc-item-active").forEach((el) => {
          el.classList.remove("active", "toc-item-active");
        });

        const subLink = document.querySelector(`.toc-sub-link[data-target="${activeId}"]`);
        const sectionHeader = document.querySelector(`.toc-section-header[data-target="${activeId}"]`);

        if (subLink) {
          subLink.classList.add("active");
          const parent = subLink.closest(".toc-section");
          if (parent) {
            parent.classList.add("toc-item-active", "open");
          }
        } else if (sectionHeader) {
          const section = sectionHeader.closest(".toc-section");
          if (section) {
            section.classList.add("toc-item-active", "open");
          }
        }
      };

      const buildFloatingToc = () => {
        const tocContainer = document.querySelector(".floating-toc");
        const tocList = tocContainer?.querySelector(".toc-list");
        if (!tocContainer || !tocList) return;

        tocList.innerHTML = "";
        if (tocState.observer) tocState.observer.disconnect();

        const headings = Array.from(document.querySelectorAll(".page h2, .page h3"));
        const usedIds = new Set();

        headings.forEach((heading, index) => {
          if (!heading.id) {
            const base =
              heading.textContent
                .trim()
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, "-")
                .replace(/^-+|-+$/g, "") || `section-${index + 1}`;

            let candidate = base;
            let counter = 1;
            while (usedIds.has(candidate)) {
              candidate = `${base}-${counter++}`;
            }
            heading.id = candidate;
            usedIds.add(candidate);
          } else {
            usedIds.add(heading.id);
          }
        });

        const sections = [];
        headings.forEach((heading) => {
          if (heading.tagName === "H2") {
            sections.push({ id: heading.id, title: heading.textContent.trim(), children: [] });
          } else if (sections.length) {
            sections[sections.length - 1].children.push({ id: heading.id, title: heading.textContent.trim() });
          }
        });

        const fragment = document.createDocumentFragment();
        sections.forEach((section, index) => {
          const sectionEl = document.createElement("div");
          sectionEl.className = "toc-section";
          if (index === 0) sectionEl.classList.add("open");

          const header = document.createElement("button");
          header.className = "toc-section-header toc-link";
          header.setAttribute("data-target", section.id);
          header.setAttribute("aria-expanded", sectionEl.classList.contains("open"));
          header.innerHTML = `<span>${section.title}</span><span class="chevron">‚Ä∫</span>`;
          header.addEventListener("click", () => {
            const isOpen = sectionEl.classList.toggle("open");
            header.setAttribute("aria-expanded", isOpen);
            smoothScrollToId(section.id);
          });

          const sublist = document.createElement("div");
          sublist.className = "toc-sublist";

          section.children.forEach((child) => {
            const link = document.createElement("a");
            link.className = "toc-sub-link";
            link.href = `#${child.id}`;
            link.setAttribute("data-target", child.id);
            link.textContent = child.title;
            sublist.appendChild(link);
          });

          sectionEl.appendChild(header);
          if (section.children.length) sectionEl.appendChild(sublist);
          fragment.appendChild(sectionEl);
        });

        tocList.appendChild(fragment);

        tocState.observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                setActiveTocItem(entry.target.id);
              }
            });
          },
          {
            rootMargin: "-35% 0px -45% 0px",
            threshold: [0.2, 0.5, 0.8],
          }
        );

        headings.forEach((heading) => tocState.observer.observe(heading));

        if (tocState.mutationObserver) tocState.mutationObserver.disconnect();
        tocState.mutationObserver = new MutationObserver(() => {
          clearTimeout(tocState.rebuildTimer);
          tocState.rebuildTimer = setTimeout(() => buildFloatingToc(), 250);
        });

        tocState.mutationObserver.observe(document.getElementById("document-content"), {
          childList: true,
          subtree: true,
        });
      };

      const setupTocToggle = () => {
        const tocContainer = document.querySelector(".floating-toc");
        const toggleBtn = tocContainer?.querySelector(".toc-toggle");
        const closeBtn = tocContainer?.querySelector(".toc-close");
        if (!tocContainer || !toggleBtn) return;

        const setOpen = (open) => {
          tocContainer.classList.toggle("open", open);
          toggleBtn.setAttribute("aria-expanded", String(open));
        };

        toggleBtn.addEventListener("click", () => {
          setOpen(!tocContainer.classList.contains("open"));
        });

        closeBtn?.addEventListener("click", () => setOpen(false));

        document.addEventListener("click", (event) => {
          if (!tocContainer.contains(event.target) && tocContainer.classList.contains("open")) {
            setOpen(false);
          }
        });
      };

      const registerSmoothScroll = () => {
        document.addEventListener("click", (event) => {
          const anchor = event.target.closest('a[href^="#"]');
          if (!anchor) return;

          const href = anchor.getAttribute("href");
          if (!href || href === "#") return;
          const targetId = href.replace("#", "");
          const target = document.getElementById(targetId) || document.querySelector(href);
          if (!target) return;

          event.preventDefault();
          smoothScrollToId(targetId);
        });
      };

      const initializeNavigation = () => {
        setupTocToggle();
        buildFloatingToc();
        registerSmoothScroll();
      };

      const initializeSearch = () => {
        const searchInput = document.getElementById("playbook-search");
        const searchResults = document.getElementById("search-results");
        const searchStatus = document.getElementById("search-status");
        const clearSearchBtn = document.getElementById("clear-search");
        const searchShell = document.querySelector(".search-shell");
        const searchToggle = document.getElementById("search-toggle");

        if (!searchInput || !searchResults || !searchStatus || !searchShell) return;

        const setSearchOpen = (open) => {
          searchShell.classList.toggle("collapsed", !open);
          if (searchToggle) searchToggle.setAttribute("aria-expanded", String(open));
          if (open) {
            searchInput.focus();
            searchInput.select();
          } else {
            searchInput.blur();
            if (!searchInput.value) {
              searchResults.innerHTML = "";
              searchResults.classList.remove("active");
              searchStatus.textContent = "Search sections, tactics, or keywords.";
            }
          }
        };

        const searchableNodes = Array.from(document.querySelectorAll(".page h2, .page h3, .page h4, .page p, .page li"));
        const searchIndex = [];
        const searchIndexMap = new Map();

        searchableNodes.forEach((node, idx) => {
          const text = (node.textContent || "").trim().replace(/\s+/g, " ");
          if (!text) return;

          const page = node.closest(".page");
          const heading = page?.querySelector("h1, h2");
          const sectionTitle = heading ? heading.textContent.trim().replace(/\s+/g, " ") : "Playbook";
          const searchId = `search-target-${idx}`;

          node.dataset.searchId = searchId;

          const entry = {
            id: searchId,
            text,
            lower: text.toLowerCase(),
            node,
            sectionTitle,
          };

          searchIndex.push(entry);
          searchIndexMap.set(searchId, entry);
        });

        const escapeHTML = (str) =>
          str
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#39;");

        const highlightTerms = (text, terms) => {
          if (!terms.length) return escapeHTML(text);
          const pattern = terms.map((term) => term.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")).join("|");
          const regex = new RegExp(`(${pattern})`, "gi");
          return text
            .split(regex)
            .map((segment, index) => {
              if (index % 2 === 1) {
                return `<mark>${escapeHTML(segment)}</mark>`;
              }
              return escapeHTML(segment);
            })
            .join("");
        };

        const renderResults = (value) => {
          const query = value.trim().toLowerCase();
          if (!query) {
            searchResults.innerHTML = "";
            searchResults.classList.remove("active");
            searchStatus.textContent = "Search sections, tactics, or keywords.";
            return;
          }

          const terms = query.split(/\s+/).filter(Boolean);
          const matches = searchIndex
            .map((item) => {
              const matchedTerms = terms.filter((term) => item.lower.includes(term));
              if (!matchedTerms.length) return null;
              const score = matchedTerms.length * 2 - Math.min(item.text.length, 260) / 260;
              return { ...item, matchedTerms, score };
            })
            .filter(Boolean)
            .sort((a, b) => b.score - a.score)
            .slice(0, 15);

          if (!matches.length) {
            searchResults.innerHTML = `<div class="search-result">No matches found.</div>`;
            searchResults.classList.add("active");
            searchStatus.textContent = `No matches for "${value.trim()}"`;
            return;
          }

          searchResults.innerHTML = matches
            .map((match) => {
              const preview = match.text.length > 220 ? `${match.text.slice(0, 220)}‚Ä¶` : match.text;
              const highlighted = highlightTerms(preview, terms);
              return `
                <button class="search-result" data-target="${match.id}" role="option" aria-label="Go to ${escapeHTML(match.sectionTitle)}">
                  <div class="search-result-title">${escapeHTML(match.sectionTitle)}</div>
                  <div class="search-preview">${highlighted}</div>
                </button>
              `;
            })
            .join("");
          searchResults.classList.add("active");
          searchStatus.textContent = `Showing ${matches.length} result${matches.length === 1 ? "" : "s"} for "${value.trim()}"`;
        };

        const focusMatch = (targetId) => {
          const entry = searchIndexMap.get(targetId);
          if (!entry) return;
          entry.node.scrollIntoView({ behavior: "smooth", block: "start" });
          entry.node.classList.add("search-hit-highlight");
          setTimeout(() => entry.node.classList.remove("search-hit-highlight"), 1800);
        };

        searchToggle?.addEventListener("click", () => {
          const isOpen = !searchShell.classList.contains("collapsed");
          setSearchOpen(!isOpen);
        });

        searchResults.addEventListener("click", (event) => {
          const target = event.target.closest(".search-result");
          if (!target) return;
          const targetId = target.getAttribute("data-target");
          if (targetId) {
            focusMatch(targetId);
            setSearchOpen(false);
          }
        });

        searchInput.addEventListener("focus", () => setSearchOpen(true));

        searchInput.addEventListener("input", (event) => {
          setSearchOpen(true);
          renderResults(event.target.value);
        });

        searchInput.addEventListener("keydown", (event) => {
          if (event.key === "Enter") {
            event.preventDefault();
            const firstResult = searchResults.querySelector(".search-result");
            firstResult?.click();
          } else if (event.key === "Escape") {
            if (searchInput.value) {
              searchInput.value = "";
              renderResults("");
            } else {
              setSearchOpen(false);
            }
          }
        });

        clearSearchBtn?.addEventListener("click", () => {
          searchInput.value = "";
          renderResults("");
          searchInput.focus();
          setSearchOpen(true);
        });

        document.addEventListener("click", (event) => {
          if (!searchShell.contains(event.target) && !searchShell.classList.contains("collapsed") && !searchInput.value) {
            setSearchOpen(false);
          }
        });
      };

      // Split long sections into multiple exactly 11in tall pages
      function splitContentIntoPages() {
        console.log('üîÑ Starting page splitting...');
        
        const pages = Array.from(document.querySelectorAll(".page:not(#cover):not(#toc)"));
        console.log(`Found ${pages.length} content pages to process`);
        
        if (pages.length === 0) {
          console.log('‚ö†Ô∏è No pages found to split');
          return;
        }
        
        const PAGE_HEIGHT_IN = 11;
        const PAGE_HEIGHT_PX = PAGE_HEIGHT_IN * 96; // 96px per inch at screen resolution
        const PADDING_IN = 1; // 1 inch top padding
        const PADDING_PX = PADDING_IN * 96;
        const PAGE_NUMBER_SPACE_PX = 60; // Space for page number (0.625in)
        const MAX_CONTENT_HEIGHT_PX = PAGE_HEIGHT_PX - PADDING_PX - PAGE_NUMBER_SPACE_PX; // Available content height
        
        console.log(`Max content height: ${MAX_CONTENT_HEIGHT_PX}px (${MAX_CONTENT_HEIGHT_PX / 96}in)`);
        
        pages.forEach((originalPage, pageIdx) => {
          const content = originalPage.querySelector(".page-content");
          if (!content) {
            console.log(`‚ö†Ô∏è Page ${pageIdx} has no .page-content`);
            return;
          }
          
          // Save original styles
          const originalContentStyle = {
            maxHeight: content.style.maxHeight,
            overflow: content.style.overflow,
            height: content.style.height
          };
          
          const originalPageStyle = {
            height: originalPage.style.height,
            maxHeight: originalPage.style.maxHeight
          };
          
          // Temporarily remove restrictions for accurate measurement
          content.style.maxHeight = 'none';
          content.style.overflow = 'visible';
          content.style.height = 'auto';
          originalPage.style.height = 'auto';
          originalPage.style.maxHeight = 'none';
          
          // Force reflow for accurate measurements
          void originalPage.offsetHeight;
          void content.offsetHeight;
          
          // Measure actual content height
          const contentHeight = content.scrollHeight;
          console.log(`Page ${originalPage.id}: content height = ${contentHeight}px (${(contentHeight / 96).toFixed(2)}in), max = ${MAX_CONTENT_HEIGHT_PX}px`);
          
          // If content fits in one page, restore styles and move on
          if (contentHeight <= MAX_CONTENT_HEIGHT_PX) {
            console.log(`‚úÖ Page ${originalPage.id} fits in one page`);
            originalPage.style.height = '11in';
            originalPage.style.maxHeight = '11in';
            content.style.maxHeight = '';
            content.style.overflow = 'hidden';
            return;
          }
          
          // Content exceeds - split it into multiple pages
          console.log(`‚úÇÔ∏è Splitting page ${originalPage.id} (content is ${contentHeight}px, exceeds ${MAX_CONTENT_HEIGHT_PX}px)`);
          
          const children = Array.from(content.children);
          if (children.length === 0) {
            console.log(`‚ö†Ô∏è Page ${originalPage.id} has no children`);
            return;
          }
          
          // Store children data before manipulation
          const childrenData = children.map(child => ({
            element: child,
            html: child.outerHTML
          }));
          
          // Clear original content
          content.innerHTML = '';
          
          // Get section info
          const sectionId = originalPage.id.replace(/-page\d+$/, '');
          const pageNumberEl = originalPage.querySelector('.page-number');
          let basePageNum = pageNumberEl ? parseInt(pageNumberEl.textContent) : 3;
          
          const newPages = [];
          let currentPage = originalPage;
          let currentPageContent = content;
          let currentHeight = 0;
          let pageCounter = 1;
          
          // Process each child element
          childrenData.forEach((childData, childIdx) => {
            // Create a temporary container to measure the child
            const tempContainer = document.createElement('div');
            tempContainer.style.cssText = 'position: absolute; visibility: hidden; width: 7.5in;';
            tempContainer.innerHTML = childData.html;
            document.body.appendChild(tempContainer);
            
            // Get the actual element from temp container
            const childElement = tempContainer.firstElementChild;
            if (!childElement) {
              document.body.removeChild(tempContainer);
              return;
            }
            
            // Force reflow
            void childElement.offsetHeight;
            
            const childHeight = childElement.offsetHeight || 100;
            
            console.log(`  Child ${childIdx} (${childElement.tagName}): height = ${childHeight}px, current total = ${currentHeight}px`);
            
            // Check if adding this child would exceed the page limit
            if (currentHeight > 0 && currentHeight + childHeight > MAX_CONTENT_HEIGHT_PX) {
              console.log(`  ‚ö†Ô∏è Child ${childIdx} exceeds limit, creating new page`);
              
              // Create new page
              const newPage = document.createElement('div');
              newPage.className = 'page';
              newPage.id = `${sectionId}-page${pageCounter + 1}`;
              newPage.style.cssText = 'width: 8.5in; height: 11in; min-height: 11in; max-height: 11in; padding: 1in; margin: 0 auto 20px; background: white; position: relative; box-shadow: 0 2px 15px rgba(0, 0, 0, 0.15); overflow: hidden; page-break-after: always; break-after: page; box-sizing: border-box; display: flex; flex-direction: column;';
              
              const newContent = document.createElement('div');
              newContent.className = 'page-content';
              newContent.style.cssText = 'flex: 1; min-height: 0; overflow: hidden; padding-bottom: 0.75in;';
              
              newPage.appendChild(newContent);
              
              // Add page number
              const newPageNumber = document.createElement('div');
              newPageNumber.className = 'page-number';
              newPageNumber.textContent = basePageNum + pageCounter;
              newPageNumber.style.cssText = 'position: absolute; bottom: 0.75in; right: 1in; font-size: 10pt; color: #666;';
              newPage.appendChild(newPageNumber);
              
              // Insert after current page
              currentPage.parentElement.insertBefore(newPage, currentPage.nextSibling);
              newPages.push(newPage);
              
              // Switch to new page
              currentPage = newPage;
              currentPageContent = newContent;
              currentHeight = 0;
              pageCounter++;
            }
            
            // Move the actual child element from temp container to current page
            currentPageContent.appendChild(childElement);
            currentHeight += childHeight;
            
            // Clean up temp container
            document.body.removeChild(tempContainer);
          });
          
          // Ensure all pages have correct height and overflow settings
          [originalPage, ...newPages].forEach((p, idx) => {
            p.style.height = '11in';
            p.style.maxHeight = '11in';
            const pc = p.querySelector('.page-content');
            if (pc) {
              pc.style.maxHeight = MAX_CONTENT_HEIGHT_PX + 'px';
              pc.style.overflow = 'hidden';
            }
          });
          
          console.log(`‚úÖ Split page ${originalPage.id} into ${newPages.length + 1} pages`);
        });
        
        console.log('‚úÖ Page splitting complete');
      }

      // Load dynamic playbook content
      async function loadPlaybookContent() {
        const container = document.getElementById("document-content");
        const existingContent = container.querySelector(".page");
        
        // If content already injected by server, skip loading
        if (existingContent && !existingContent.id.includes("loading")) {
          console.log("‚úÖ Playbook content already loaded from server");
          // Split content into pages after rendering completes
          setTimeout(() => {
            splitContentIntoPages();
            // Re-run after a longer delay to ensure all content is rendered
            setTimeout(() => {
              splitContentIntoPages();
              initializeNavigation();
              initializeSearch();
            }, 500);
          }, 200);
          return;
        }

        // Show loading message
        const loadingHtml = '<div id="loading-message" style="text-align: center; padding: 40px; color: #666;"><p>Loading playbook content...</p></div>';
        // Content will be injected by server or loaded via API
        // Check if content is already loaded (injected by server)
        const existingPages = container.querySelectorAll(".page");
        if (existingPages.length > 0) {
          console.log("‚úÖ Playbook content already loaded from server");
          setTimeout(() => {
            splitContentIntoPages();
            setTimeout(() => {
              splitContentIntoPages();
              initializeNavigation();
              initializeSearch();
            }, 500);
          }, 200);
          return;
        }
        
        // Show loading message
        const marker = container.innerHTML.match(/<!-- DYNAMIC_CONTENT -->/);
        if (marker) {
          container.innerHTML = container.innerHTML.replace(
            /<!-- DYNAMIC_CONTENT -->[\s\S]*/,
            loadingHtml
          );
        } else {
          container.insertAdjacentHTML("beforeend", loadingHtml);
        }

        try {
          const response = await fetch("/api/playbook");
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.json();
          
          // Replace loading message with content
          const loadingMsg = document.getElementById("loading-message");
          if (loadingMsg) {
            loadingMsg.outerHTML = data.html;
          } else {
            // If no loading message, insert content
            container.innerHTML = '<!-- DYNAMIC_CONTENT -->' + data.html + '</div>';
          }
          
          console.log(`‚úÖ Playbook loaded: ${data.sections} sections`);
          
          // Initialize navigation and search after content loads
          // Use multiple timeouts to ensure content is fully rendered before splitting
          setTimeout(() => {
            splitContentIntoPages();
            // Re-run after longer delay to catch any late-rendered content
            setTimeout(() => {
              splitContentIntoPages();
              initializeNavigation();
              initializeSearch();
            }, 500);
          }, 300);
        } catch (error) {
          console.error("‚ùå Error loading playbook:", error);
          const loadingMsg = document.getElementById("loading-message");
          if (loadingMsg) {
            loadingMsg.innerHTML = `
              <p><strong>Error loading playbook content</strong></p>
              <p>${error.message}</p>
              <p><button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; cursor: pointer;">Retry</button></p>
            `;
            loadingMsg.style.color = "#e74c3c";
          }
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadPlaybookContent();
      });

      // PDF Export Function
      function exportToPDF() {
        const btn = document.querySelector(".pdf-export-btn");
        const originalText = btn.textContent;

        btn.classList.add("exporting");
        btn.textContent = "‚è≥ Generating PDF...";
        btn.disabled = true;

        // Wait for images to load
        const images = document.querySelectorAll("img");
        const imagePromises = Array.from(images).map((img) => {
          if (img.complete && img.naturalWidth > 0) {
            return Promise.resolve();
          }
          return new Promise((resolve) => {
            img.onload = resolve;
            img.onerror = resolve; // Continue even if image fails
            setTimeout(resolve, 3000); // Timeout after 3 seconds
          });
        });

        Promise.all(imagePromises).then(() => {
          // Small delay to ensure everything is rendered
          setTimeout(() => {
            const element = document.getElementById("document-content");

            if (!element) {
              console.error("Document content element not found");
              btn.classList.remove("exporting");
              btn.textContent = "‚ùå Error - Element not found";
              btn.disabled = false;
              return;
            }

            // Ensure element is visible and has content
            if (element.offsetHeight === 0 || element.offsetWidth === 0) {
              console.error("Document content has no dimensions");
              btn.classList.remove("exporting");
              btn.textContent = "‚ùå Error - No content to export";
              btn.disabled = false;
              return;
            }

            // Scroll to top to ensure we start from the beginning
            window.scrollTo(0, 0);
            element.scrollIntoView({ behavior: "instant", block: "start" });

            // Hide UI elements that shouldn't be in PDF
            const exportBtn = document.querySelector(".pdf-export-btn");
            const floatingToc = document.querySelector(".floating-toc");
            const searchToolbar = document.querySelector(".search-toolbar");
            const searchShell = document.querySelector(".search-shell");
            const originalBtnDisplay = exportBtn ? exportBtn.style.display : "";
            const originalTocDisplay = floatingToc ? floatingToc.style.display : "";
            const originalSearchDisplay = searchToolbar ? searchToolbar.style.display : "";
            const originalSearchShell = searchShell ? searchShell.style.display : "";

            if (exportBtn) exportBtn.style.display = "none";
            if (floatingToc) floatingToc.style.display = "none";
            if (searchToolbar) searchToolbar.style.display = "none";
            if (searchShell) searchShell.style.display = "none";

            // Ensure element is visible and has proper dimensions
            const originalBodyBg = document.body.style.background;
            document.body.style.background = "#ffffff";

            // Force a reflow to ensure rendering
            void element.offsetHeight;

            // Temporarily adjust styles for better PDF rendering
            const pages = element.querySelectorAll(".page");
            const originalStyles = [];
            pages.forEach((page, index) => {
              originalStyles[index] = {
                overflow: page.style.overflow,
                height: page.style.height,
                minHeight: page.style.minHeight,
                maxHeight: page.style.maxHeight
              };
              // Allow pages to flow naturally
              page.style.overflow = "visible";
              page.style.height = "auto";
              page.style.minHeight = "auto";
              page.style.maxHeight = "none";
            });

            const opt = {
              margin: [0.5, 0.5, 0.5, 0.5],
              filename: "Specialty_Farmer_Program_Execution_Playbook.pdf",
              image: { type: "jpeg", quality: 0.98 },
              html2canvas: {
                scale: 2,
                useCORS: true,
                allowTaint: false,
                letterRendering: true,
                logging: false,
                backgroundColor: "#ffffff",
                removeContainer: false,
              },
              jsPDF: {
                unit: "in",
                format: "letter",
                orientation: "portrait",
              },
              pagebreak: {
                mode: "css",
                before: ".page#cover, .page#toc, h2",
                after: ".page#cover, .page#toc",
                avoid: [".pipeline-diagram", ".image-container"],
              },
            };

            // Use a promise to handle the export
            const pdfPromise = html2pdf().set(opt).from(element);

            const restoreStyles = () => {
              // Restore page styles
              pages.forEach((page, index) => {
                if (originalStyles[index]) {
                  page.style.overflow = originalStyles[index].overflow || "";
                  page.style.height = originalStyles[index].height || "";
                  page.style.minHeight = originalStyles[index].minHeight || "";
                  page.style.maxHeight = originalStyles[index].maxHeight || "";
                }
              });
              // Restore UI elements and styles
              if (exportBtn) exportBtn.style.display = originalBtnDisplay;
              if (floatingToc) floatingToc.style.display = originalTocDisplay;
              if (searchToolbar) searchToolbar.style.display = originalSearchDisplay;
              if (searchShell) searchShell.style.display = originalSearchShell;
              document.body.style.background = originalBodyBg;
            };

            pdfPromise
              .save()
              .then(() => {
                restoreStyles();
                btn.classList.remove("exporting");
                btn.textContent = originalText;
                btn.disabled = false;
              })
              .catch((error) => {
                console.error("PDF export error:", error);
                console.error("Element dimensions:", {
                  width: element.offsetWidth,
                  height: element.offsetHeight,
                  scrollWidth: element.scrollWidth,
                  scrollHeight: element.scrollHeight,
                });

                restoreStyles();
                btn.classList.remove("exporting");
                btn.textContent = "‚ùå Error - Try Again";
                btn.disabled = false;
                setTimeout(() => {
                  btn.textContent = originalText;
                }, 3000);
              });
          }, 500);
        });
      }

      // Handle logo loading
      window.addEventListener("load", function () {
        const logo = document.getElementById("ssw-logo");
        if (logo) {
          logo.addEventListener("load", function () {
            this.style.display = "block";
          });
          logo.addEventListener("error", function () {
            // Logo not found, hide the container
            this.parentElement.style.display = "none";
          });
          // Try to load the logo
          const logoPath = "assets/logo/ssw-logo.png";
          const testImg = new Image();
          testImg.onload = function () {
            logo.src = logoPath;
            logo.style.display = "block";
          };
          testImg.onerror = function () {
            // Logo not found, hide container
            document.querySelector(".logo-container").style.display = "none";
          };
          testImg.src = logoPath;
        }
      });
    </script>
  </body>
</html>
